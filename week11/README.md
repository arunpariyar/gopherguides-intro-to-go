<p align="center">
<img width="532" alt="Screen Shot 2021-11-28 at 21 50 07" src="https://user-images.githubusercontent.com/4984347/143785807-a662ea9c-8592-4da1-bf09-1a0dcd37c7ec.png">
 </p>

## UGotNews

**Streamline your news with simple catagories and keep them news coming :)**

UGotNews is a simple news service designed to deliver your news based on simple catagories.

#### Introduction And Overview

This project is part of the assignment under the curriculum of Intro to Go course provided by Gopher Guides.

UGotNews API can be imported and used in your projects, it also incorporates a command line to interface with UGotNews.

##### Built With

This project is built with Go by a beginner Gopher

## Under The Hood

UGotNews works atop service that is the heart of the application. All the building blocks that make the serice are introduced below.

##### Article

`Article` is the smallest working unit of the application that represents a news in its raw form. A collection type `Articles` is also defined for ease of use. _(Definition & Usage)_

##### Category

`Category` is provides the area of news an article provides such as politics, arts e.t.c. A collection type `Categories` is also defined for ease of use.

##### News

`News` is the final product generated by the service and represents a complete news._(Definition & Usage)_

##### Source

`Source` is interface implementation over which a desired news source can be built. _(Definition & Usage)_

##### Service

`Service` is the core that makes this application work. A publish/subsribe implementation it is capable of concurrently handling many sources and subscribers at a time. _(Definition & Usage)_

## Getting Started

Follow the simple steps below to get started.
Prerequisites
Please make sure to install Go 1.17 before you start, you can download Go from [here](https://go.dev/).

#### Installation:

go get github.com/arunpariyar/gopherguides-intro-to-go/tree/week11

## Definition and Usuage

##### Service API

```
type Service struct {
	subs    map[string]Categories
	srcs    []string
	sub_chl map[string]chan News
	src_chl map[string]chan Article
	History map[int]News
	Once    sync.Once
	stopped bool
	cancel  context.CancelFunc
	sync.RWMutex
}
```

Service is solely responsible for managing the tasks below

- Generating a news instance of service

  ```
    func NewService() *Service {...}
  ```

- Starting a Service
  ```
  func (ns *Service) Start(ctx context.Context) {...}
  ```
- Creating a new subscriber
  ```
  func (ns *Service) Subscribe(n string, cs ...Category) {...}
  ```
- Removing an existing subscriber
  ```
  func (ns *Service) Unsubscribe(s string) error {...}
  ```
- Adding a news source
  ```
  func (ns *Service) Add(ctx context.Context, s Source) {...}
  ```
- Removing an existing news source
  ```
  func (ns *Service) Remove(ctx context.Context, s Source) error {...}
  ```
- Keeping watch on the subscriber channels
  ```
  func SubListener(ch chan News) {...}
  ```
- Listening for articles coming from news sources

  ```
  func (ns *Service) SrcListener(ctx context.Context, ch chan Article) {...}
  ```

- Publish news and distribute to relevent subscribers
  ```
  func (ns *Service) Publish(n News) {..}
  ```
- Stopping its service

  ```
  func (ns *Service) Stop() {...}
  ```

#### Source Interface

```
type Source interface {
	Name() string
	Publish(context.Context, Article)
	News() chan Article
}
```

#### Predefined Source API (! Only for testing)

It is possible to create new sources based on the intefaces. However for ease two sources Mock News Source and File Based Sources is creating for test purposes.

##### Mock news source

```
type MockSource struct {
	name    string
	news    chan Article
	cancel  context.CancelFunc
	stopped bool
	Once    sync.Once
	sync.RWMutex
}
```

A user controlled news source that allows the task below

- Create a new mock news service
  ```
  func NewMockSource(s string) *MockSource {...}
  ```
- Start the new mock new

  ```
  func (ms *MockSource) Start(ctx context.Context) context.Context {..}
  ```

- Feeding stories on by one
  ```
  func (ms *MockSource) Publish(ctx context.Context, s Article) {...}
  ```
- Closing the mock source
  ```
  func (ms *MockSource) Stop() {...}
  ```

##### File based source

```
type FileSource struct {
	name    string
	news    chan Article
	cancel  context.CancelFunc
	stopped bool
	Once    sync.Once
	sync.RWMutex
}
```

A file based news source that reads a JSON files and feeds it to the news service. It allows the task below.

- Create a new file based source
  ```
  func NewFileSource(s string) *FileSource {...}
  ```
- Start a file based source

  ```
  func (nfs *FileSource) Start(ctx context.Context) context.Context {...}

  ```

- Feed articles

  ```
  func (nfs *FileSource) PublishStories() error {...}
  ```

- Close file base source
  ```
  func (nfs *FileSource) Stop() {...}
  ```

## Command Line

The application provides a CLI integration to run the application the following commands are currently integrated the application.

- **Read Command**

  The `Read` command allows to read from the history of the service and print them as desired

  The available flags are:

  - `-j` : for output in JSON format
  - `-f` : location for the backup file
  - `-o` : output result to a file

  Some Example commands you can use are:

  - `go run cmd/ugotnews/main.go read 1,2,3,4,5`
  - `go run cmd/ugotnews/main.go read -j 1,2,3,4,5`
  - `go run cmd/ugotnews/main.go read -o ./articles.json 1,2,3,4,5`
  - `go run cmd/ugotnews/main.go read -o ./articles.json -j -f ./tmp/news.json 1, 2, 3, 4, 5`

- **Clear Command**
  The `clear` command clears the news service of all news stories
  The available flags are:

  - `-f` : file location of the backup file

  Some Example commands you can use are:

  - `go run cmd/ugotnews/main.go clear`
  - `go run cmd/ugotnews/main.go clear news_service.json`

**_Unfortunatley as of yet only the clear and read command has been integreted to the application_**

## Examples

## Existing Issues

- [ ] Integration of root command and stream command
- [ ] The App doesnot wait for message to come but exits once the initial articles are send down from subscribers
- [ ] Integration of defined Errors
- [ ] I believe that the packages could be better organised

## Testing

Once you have a local copy of the project you can run the testings using the command `go test -v`.

## Contributing

While this project is still at its early stage. If you wish to make any contributions you are most welcome and **greatly appreciated.**

if you have any suggestion, please for the repo and create a pull request. You can also simply open an issue with the tag "suggestion". Don't forget to give the UGotNews a star! Thanks Again!

1. Fork the Project
2. Create your Feature Branch (git checkout -b feature/AmazingFeature)
3. Commit your Changes (git commit -m 'Add some AmazingFeature')
4. Push to the Branch (git push origin feature/AmazingFeature)
5. Open a Pull Request

## License

Distributed under the MIT License. See LICENSE.txt for more information.

## About the author

I aspire to be developer but the developement world is huge and its important to find what works, what doesn't, if it clicks or its doesn't, love it or hate it.

I am currently in this process and heavily suffering from imposter syndrome, some days more that others but I believe in the light at the end of the tunnel.

This project is a journey child of exploring the Go Programming Language under the guidance of Gopher Guides Instructor Mark Bates.

## Acknowlegments

A journey is owed to those that point the way to the true north,its so easy to feel lost. I owe it to the Gopher Guides team Mark Bates and Corey Lou. I wouldnt have made it to the finish line otherwise.

A journey also means meeting in the journey as we who become companions.
My sincerest thanks to Naveen and Christopher for being the most resourceful companions to sit beside the fire in cold night and their help in making this project an achievable endeavour.
